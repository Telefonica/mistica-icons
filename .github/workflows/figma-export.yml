name: ðŸš€ Release (Figma)

on:
  workflow_dispatch:
    inputs:
      release:
        description: 'Release version'
        required: true 

# push:
#   paths:
#     - ".github/workflows/figma-export.yml"

jobs:
  assets:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - name: Get branch name
        uses: rlespinasse/github-slug-action@v3.x

      - run: npm install figma-export-icons --save

      - run: git checkout -b ${{ github.event.inputs.release }}

      - name: Generate icon config
        run: |
          sed -e 's/YOUR_PERSONAL_TOKEN/${{secret.FIGMA_TOKEN}}/' -e 's/ICON_FRAME/Filled/' -e 's|ICON_PATH|icons-figma/Default/filled|g' figma-export-icons.template.json > default-filled.json
          sed -e 's/YOUR_PERSONAL_TOKEN/${{secret.FIGMA_TOKEN}}/' -e 's/ICON_FRAME/Regular/' -e 's|ICON_PATH|icons-figma/Default/regular|g' figma-export-icons.template.json > default-regular.json
          sed -e 's/YOUR_PERSONAL_TOKEN/${{secret.FIGMA_TOKEN}}/' -e 's/ICON_FRAME/Light/' -e 's|ICON_PATH|icons-figma/Default/light|g' figma-export-icons.template.json > default-light.json

      - name: Export icons
        run: |
          npm run export-icons-filled
          npm run export-icons-regular
          npm run export-icons-light

      - name: Commit & Push
        run: |
          git config user.name "Bot"
          git config user.email "nobody@nowhere"  
          git commit -am "Update figma icons"
          git add -A
          git push origin ${{ github.event.inputs.release }}

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v3
        with:
          title: '${{ github.event.inputs.release }}'
          branch: ${{ github.event.inputs.release }}
          base: production
          assignees: yceballost
